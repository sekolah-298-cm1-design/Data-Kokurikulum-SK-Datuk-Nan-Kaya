<!DOCTYPE html>
<html lang="ms">
<head>
<meta charset="UTF-8">
<title>Senarai Murid | SK Datuk Nan Kaya</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<nav>
<a href="index.html">üè† Utama</a>
<a href="daftar.html">üßæ Daftar Murid</a>
<a href="dashboard.html">üìä Dashboard</a>
</nav>

<h2>üìã Senarai Murid Kokurikulum</h2>

<div id="loading">Memuatkan data murid...</div>

<table id="jadual" style="display:none;">
<thead>
<tr id="theadRow">
<th>Kelas</th>
<th>Nama Murid</th>
<th>No MyKid</th>
<th>Unit Beruniform</th>
<th>Kelab / Persatuan</th>
<th>Sukan / Permainan</th>
<th>Rumah Sukan</th>
</tr>
</thead>
<tbody id="dataBody"></tbody>
</table>

<button class="kembali" onclick="window.location.href='dashboard.html'">üîô Kembali ke Dashboard</button>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycby6se_oofVNBtIDNHNf4-owN8ONs_WJ4rU95P4TsBfccuZjj_7qv8L803UDfmL_FLCS/exec?action=dapatkan";
let semuaData = [];

// Muat data dari Google Sheets
function muatData() {
  return fetch(WEB_APP_URL)
    .then(r => r.json())
    .then(data => {
      semuaData = data;
      paparJadualFull(data);
    })
    .catch(err => {
      document.getElementById("loading").innerText="Ralat:"+err;
    });
}

// Papar semua data lengkap (7 kolum)
function paparJadualFull(data){
  const tbody = document.getElementById("dataBody");
  const theadRow = document.getElementById("theadRow");
  
  theadRow.innerHTML = `
    <th>Kelas</th>
    <th>Nama Murid</th>
    <th>No MyKid</th>
    <th>Unit Beruniform</th>
    <th>Kelab / Persatuan</th>
    <th>Sukan / Permainan</th>
    <th>Rumah Sukan</th>
  `;
  
  tbody.innerHTML = "";
  if(data.length===0){
    tbody.innerHTML="<tr><td colspan='7'>Tiada rekod murid.</td></tr>";
  } else {
    data.forEach(item=>{
      tbody.innerHTML+=`<tr>
        <td>${item.kelas}</td>
        <td>${item.nama}</td>
        <td>${item.mykid}</td>
        <td>${item.unit}</td>
        <td>${item.kelab}</td>
        <td>${item.sukan}</td>
        <td>${item.rumah}</td>
      </tr>`;
    });
  }
  document.getElementById("loading").style.display="none";
  document.getElementById("jadual").style.display="table";
}

// Papar senarai murid tapis (3 kolum)
function paparJadualTapis(data, kolum){
  const tbody = document.getElementById("dataBody");
  const theadRow = document.getElementById("theadRow");
  
  // Tajuk kolum 3 ikut bar yang diklik
  theadRow.innerHTML = `
    <th>Nama Murid</th>
    <th>No MyKid</th>
    <th>${kolum.charAt(0).toUpperCase() + kolum.slice(1)}</th>
  `;
  
  tbody.innerHTML = "";
  if(data.length===0){
    tbody.innerHTML = "<tr><td colspan='3'>Tiada rekod murid.</td></tr>";
  } else {
    data.forEach(item=>{
      tbody.innerHTML+=`<tr>
        <td>${item.nama}</td>
        <td>${item.mykid}</td>
        <td>${item[kolum]}</td>
      </tr>`;
    });
  }
  
  document.getElementById("loading").style.display="none";
  document.getElementById("jadual").style.display="table";
}

// Tapis data ikut bar klik
function tapisDariDashboard(kategori, nilai){
  let hasil = [];
  let kolumTapis = "";

  if(kategori==="chartUnit"){ 
    hasil = semuaData.filter(i=>i.unit && i.unit.toLowerCase()===nilai.toLowerCase());
    kolumTapis = "unit";
  }
  if(kategori==="chartKelab"){ 
    hasil = semuaData.filter(i=>i.kelab && i.kelab.toLowerCase()===nilai.toLowerCase());
    kolumTapis = "kelab";
  }
  if(kategori==="chartSukan"){ 
    hasil = semuaData.filter(i=>i.sukan && i.sukan.toLowerCase()===nilai.toLowerCase());
    kolumTapis = "sukan";
  }
  if(kategori==="chartRumah"){ 
    hasil = semuaData.filter(i=>i.rumah && i.rumah.toLowerCase()===nilai.toLowerCase());
    kolumTapis = "rumah";
  }

  paparJadualTapis(hasil, kolumTapis);
}

// Jalankan bila page load
window.onload = () => {
  muatData().then(()=>{
    const kategori = localStorage.getItem("tapisKategori");
    const nilai = localStorage.getItem("tapisNilai");
    if(kategori && nilai){
      tapisDariDashboard(kategori, nilai);
      localStorage.removeItem("tapisKategori");
      localStorage.removeItem("tapisNilai");
    }
  });
};
</script>

</body>
</html>
